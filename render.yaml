# Render.com Infrastructure as Code
# Learning Hall - Next.js + Payload CMS LMS Platform

services:
  # Main Application - Next.js + Payload CMS
  - type: web
    name: learning-hall-api
    runtime: node
    region: oregon
    plan: starter
    buildCommand: NODE_ENV=development npm ci && npm run build
    startCommand: NODE_ENV=production npm start
    healthCheckPath: /api/health
    envVars:
      - key: NODE_VERSION
        value: "20"
      - key: NODE_ENV
        value: production
      - key: DATABASE_URL
        fromDatabase:
          name: learning-hall-db
          property: connectionString
      - key: PAYLOAD_SECRET
        generateValue: true
      - key: SESSION_SECRET
        generateValue: true
      - key: STORAGE_ENCRYPTION_KEY
        generateValue: true
      - key: NEXT_PUBLIC_URL
        sync: false

  # Background Worker (for video transcoding, etc.)
  - type: worker
    name: learning-hall-worker
    runtime: node
    region: oregon
    plan: starter
    buildCommand: NODE_ENV=development npm ci && npm run build
    startCommand: npm run worker
    envVars:
      - key: NODE_VERSION
        value: "20"
      - key: NODE_ENV
        value: production
      - key: DATABASE_URL
        fromDatabase:
          name: learning-hall-db
          property: connectionString
      - key: PAYLOAD_SECRET
        sync: false
      - key: REDIS_URL
        sync: false

databases:
  - name: learning-hall-db
    databaseName: learning_hall
    region: oregon
    plan: basic

# Notes:
# - Redis: Configure via Dashboard > New > Redis (not available in render.yaml)
# - Storage: Configure S3/R2/GCS credentials in Dashboard after deployment
# - Worker: Requires REDIS_URL to be manually set after Redis is created
